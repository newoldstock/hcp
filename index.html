<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-------------------------------------------------------------------------------------
This program was developed using the following open source software: OpenLayers, Heron, 
GeoExt, and jQuery, and is subject to the terms and conditions of the open source software
license agreements.  The open source software is shared without any warranty; without even
the implied warranty of merchantability or fitness for a particular purpose.  
See the individual license agreements for additional information.
-------------------------------------------------------------------------------------->

<html>
	<head>
		<meta charset='utf-8'/>
		<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, no-store, must-revalidate">
		<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
		<META HTTP-EQUIV="Expires" CONTENT="0">		
		<title>Habitat Agency Geobrowser</title>
		<link rel="stylesheet" type="text/css" href="./appcss.css"/>		
		<link rel="stylesheet" type="text/css" href="./splash.css"/>
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		  ga('create', 'UA-43147609-1', 'hcpmaps.com');
		  ga('send', 'pageview');
		</script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="./jquery.blockUI.js"></script>

		<link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-3.4.0/resources/css/ext-all.css"/>
		<script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/adapter/ext/ext-base.js"></script>
		<script type="text/javascript" src="http://extjs.cachefly.net/ext-3.4.0/ext-all.js"></script>

		<!-- External lib: OpenLayers -->
		<link rel="stylesheet" type="text/css" href="http://lib.heron-mc.org/openlayers/2.12/theme/default/style.css"/>
		<script type="text/javascript" src="http://lib.heron-mc.org/openlayers/2.12/OpenLayers.js"></script>
		<!-- External lib: GeoExt -->
		<script type="text/javascript" src="http://lib.heron-mc.org/geoext/1.1/script/GeoExt.js"></script>
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>

		<link rel="stylesheet" type="text/css" href="../heron/resources/css/default.css"/>

		<script type="text/javascript" src="../heron/script/Heron.js"></script>

		<script type="text/javascript" src="./Options.js"></script>
		<script type="text/javascript" src="./Layers.js"></script>		
		<script type="text/javascript" src="./Config.js"></script>	
		<script type="text/javascript" src="./printThis.js"></script>	
		<script type="text/javascript" src="./splash.js"></script>		
		<script type="text/javascript">
			var startBounds = new OpenLayers.Bounds(-13608798.972234, 4423388.4771902, -13490321.578408, 4509609.4450838);
			//Function to disable Google 45-degree tilt
			function setFixes()
			{
			try
				{
				Heron.App.map.zoomToExtent(startBounds); //unrelated opportunity to zoom to extent of County
				gHyb.mapObject.setTilt(0);
				}
			catch(err)
				{
				//This is because IE fires the onLoad event too early
				setTimeout(function(){setFixes()}, 1000);
				}

			};
			
			//Function to create Ext windows for instructions and report
			function makeWindow()
			{
				OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;
				//Heron.App.map.zoomToMaxExtent();
				win = new Ext.Window({
					applyTo:'welcome_instr',
					layout:'fit',
					width:600,
					height:365,
					closeAction:'hide',
					plain: true,

					items: new Ext.TabPanel({
						applyTo: 'welcome_instr_tabs',
						autoTabs:true,
						activeTab:0,
						deferredRender:false,
						border:false,
						defaults:{ autoScroll:true }
					})
				});
				
				reportWin = new Ext.Window({
					applyTo:'report_win',
					layout:'fit',
					width:800,
					height:600,
					closeAction:'hide',
					plain: true,
					
					items: new Ext.TabPanel({
						applyTo: 'report_win_tabs',
						autoTabs:true,
						activeTab:0,
						deferredRender:false,
						border:false,
						defaults:{ autoScroll:true }
					})				
				});
			};
					
		</script> 
	</head>
<body onload="setFixes(); makeWindow(); ">
<div id="welcome_instr" class="x-hidden">
    <div class="x-window-header">Habitat Agency Geobrowser</div>
    <div id="welcome_instr_tabs">
        <!-- Auto create tab  -->
        <div class="x-tab" title="Instructions" style="margin: 10px;">
			<h1>How To Use The Geobrowser</h1><br>
			<p>The geobrowser displays mapping data as a series of layers, listed in the left-hand column, each with a check box to switch their visibility on or off.
				The layers are organized into "Base Layers" and "Overlays" groups.  Base layers provide satellite imagery, terrain, and street maps as a foundation onto 
				which the overlay layers are displayed.  Layers positioned higher in the list are drawn above lower items within the map.  
				Change the order of display by clicking and dragging the title of a layer to a new location in the list.  Some layers (e.g. Parcels) are only 
				visible at limited zoom levels.</p><br>
			<p>Double-click on the map to zoom in and center the display at that location.  Hold down the shift key to draw a zoom extent.</p><br>
			<h1>The Toolbar</h1>
			<img src="./resources/hcp_toolbar.jpg">

			<p>The toolbar is located above the map and contains a set of tools that provide navigation, measuring, and search capabilities.  Hover the mouse over 
				a tool to see a brief description of the tool's functionality.</p><br>
			<h1><img src="./resources/help_tool.jpg"> Instructions</h1>
			<p>Open this window and display these instructions.</p><br>				

			<h1><img src="./resources/pan.jpg"> Pan</h1>
			<p>Click and drag to shift the contents of the map view.</p><br>
			
			<h1><img src="./resources/zoom_in.jpg"> Zoom In</h1>
			<p>Zoom into the map one level, centering the display at the location clicked.</p><br>

			<h1><img src="./resources/zoom_out.jpg"> Zoom Out</h1>
			<p>Zoom out from the map one level, centering the display at the location clicked.</p><br>

			<h1><img src="./resources/zoom_to_coordinates.jpg"> Enter Coordinates, Go To Location</h1>
			<p>Center and zoom the map to a location entered as latitude and longitude coordinates.</p><br>

			<h1><img src="./resources/previous_extent.jpg"> Zoom Previous</h1>
			<p>Click to zoom to your last location.</p><br>

			<h1><img src="./resources/zoom_next.jpg"> Zoom Next</h1>
			<p>Click to forward the map to the next location. This button is only available after having clicked Zoom Previous one or more times.</p><br>

			<h1><img src="./resources/measure_length.jpg"> Measure Length</h1>
			<p>Draw a line on the map, with the length of the line displayed below the map at the bottom of the window. Click within the map to start measuring
				and double-click to stop. Hold down the shift key to draw freehand, making the tracing of irregular features a quick task.</p><br>

			<h1><img src="./resources/measure_area.jpg"> Measure Area</h1>
			<p>Draw a polygon on the map, with the area of the polygon displayed below the map at the bottom of the window. Click within the map to start measuring and
			 double-click to stop. Hold down the shift key to easily draw freehand shapes around complex features.</p><br>
			 
			<h1><img src="./resources/feature_information.jpg"> Feature Information</h1>
			<p>Click within the map to display attribute information from the visible layers at the location clicked. If data from more than one layer is returned,
				 the information window will contain multiple tabs, one for each layer.</p><br>
				 
			<h1><img src="./resources/parcel_report_button.jpg"> Generate Parcel Report</h1>
			<p>Click on a parcel to generate a report which lists all of the HCP-relevant data located on the property.</p><br>	
			
			<h1><img src="./resources/poly_report_button.jpg"> Generate Area Report</h1>
			<p>Use this tool to generate a report which lists all of the HCP-relevant data located within a user-drawn area.</p><br>				
		</div>			
    </div>
</div>

<div id="report_win" class="x-hidden">
    <div class="x-window-header">Property Report</div>
	    <div id="report_win_tabs">
        <!-- Auto create tab  -->
        <div class="x-tab" title="Analysis Results" style="margin: 10px;" id="report">
		<div id="printit" style="width: 100px; margin: 0 auto; color:#00AA00;"><h1 align="center" style="background-color:#EEEEEE; padding: 5px;">Print Report</h1></div>
		<div id="report-content">
		</div>
		</div>
		</div>	
</div>
<script type="text/javascript">
	// jQuery: tie print function to "print" div on report
	$("#printit").click(function() {
		$("#report-content").printThis();
		});
	$("#printit").hover(function() {
		$(this).css('cursor', 'pointer');
		});
		
	var reportmap;

	//Initialize map on report
	function reportMapInit() {
		var options = {
			projection: "EPSG:900913",
			units: "m",
			resolutions: [156543.03390625, 78271.516953125, 39135.7584765625, 19567.87923828125, 
			9783.939619140625, 4891.9698095703125, 2445.9849047851562, 1222.9924523925781, 611.4962261962891, 
			305.74811309814453, 152.87405654907226, 76.43702827453613, 38.218514137268066, 19.109257068634033, 
			9.554628534317017, 4.777314267158508, 2.388657133579254, 1.194328566789627, 0.5971642833948135, 
			0.29858214169740677, 0.14929107084870338, 0.07464553542435169, 0.037322767712175846, 0.018661383856087923, 
			0.009330691928043961, 0.004665345964021981, 0.0023326729820109904, 0.0011663364910054952, 5.831682455027476E-4, 
			2.915841227513738E-4, 1.457920613756869E-4],	
			maxExtent: new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),
			restrictedExtent: new OpenLayers.Bounds(-13670713, 4393119, -13438956, 4539114),
			center: '-13553000, 4465500',
			zoom: 9,
			theme: null,
			numZoomLevels: 21,
			controls: []
		};				
				
	
		reportmap = new OpenLayers.Map('report-map', options);
		var naip = new OpenLayers.Layer.WMS(
			"naip",
			'http://www.hcpmaps.com/geoserver/HCP/wms?',
			{layers: "HCP:NAIP2012", tiled: true},
			{singleTile: false, isBaseLayer: true, visibility: true, noLegend: false, numZoomLevels: 21}
		);

		var parcels = new OpenLayers.Layer.WMS(
			"Parcels",
			'http://www.hcpmaps.com/geoserver/HCP/wms?',
			{layers: "HCP:parcels_proj", transparent: true, format: 'image/png', tiled: true},
			{singleTile: false, opacity: 1.0, isBaseLayer: false, visibility: true, noLegend: false, featureInfoFormat:
				'application/vnd.ogc.gml', maxResolution: 19.109257068634033}
		);
		
		reportmap.addLayers([parcels, naip]);
		//theExtent = Heron.App.map.getExtent();
		//reportmap.zoomToExtent(theExtent);
		//reportmap.zoomIn();

	}	

</script>

</body> 
</html>
